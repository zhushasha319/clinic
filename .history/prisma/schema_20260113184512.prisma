// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
 
// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init
 
generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
  previewFeatures = ["driverAdapters"]
}
 
datasource db {
  provider = "postgresql"
  
}
 
// Enum for user roles
enum Role {
  PATIENT
  DOCTOR
  ADMIN
}
 
// Enum for doctor leave types
enum LeaveType {
  FULL_DAY
  MORNING
  AFTERNOON
}
 
// Enum for patient types in an appointment
enum PatientType {
  MYSELF
  SOMEONE_ELSE
}
 
// Enum for appointment status
enum AppointmentStatus {
  PAYMENT_PENDING
  BOOKING_CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
  CASH
}
 
// Enum for transaction status
enum TransactionStatus {
  COMPLETED
  FAILED
  CANCELLED
}
 
// 1. User Table
// Stores core information for all registered individuals.
model User {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String   @default("NO_NAME")
  email         String    @unique
  password      String?
  emailVerified DateTime?
  role          Role      @default(PATIENT)
  isRootAdmin   Boolean?  @default(false)
  image         String?
  dateofbirth   DateTime?
  phoneNumber   String?
  address       String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
 
  // --- Relationships ---
  accounts         Account[]
  doctorProfile    DoctorProfile?
  doctorLeaves     DoctorLeave[]
  doctorAppointments Appointment[]     @relation("DoctorAppointments")
  userAppointments Appointment[]    @relation("UserAppointments")
  doctorTestimonials DoctorTestimonial[] @relation("DoctorTestimonials")
  patientTestimonials DoctorTestimonial[]@relation("PatientTestimonials")
  transactions     Transaction[]
 
  @@map("users")
}
 
// 2. Account Table
// Links user accounts to third-party authentication providers.
model Account {
  id                String    @id @default(cuid())
  userId            String @db.Uuid
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?   @db.Text
  access_token      String?   @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?   @db.Text
  session_state     String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
 
  // --- Relationships ---
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  // --- Constraints ---
  @@unique([provider, providerAccountId])
  @@map("accounts")
}
 
// 3. VerificationToken Table
// Stores tokens for verifying user actions like email confirmation.
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
 
  // --- Constraints ---
  @@unique([identifier, token])
  @@map("verification_tokens")
}
 
// 4. DoctorProfile Table
// Stores specialized information for users with the DOCTOR role.
model DoctorProfile {
  profileId      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String   @unique @db.Uuid
  specialty      String
  brief          String   @db.Text
  credentials    String
  languages      String[]
  rating         Float    @default(0)
  reviewCount    Int      @default(0)
  specializations String[]
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
 
  // --- Relationships ---
  doctor User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
 @@map("doctor_profiles")
 
}
 
// 5. DoctorLeave Table
// Tracks the leave and unavailability of doctors.
model DoctorLeave {
  leaveId   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId  String @db.Uuid
  leaveDate DateTime  @db.Date
  leaveType LeaveType
  reason    String? @db.Text
  createdAt DateTime  @default(now())
 
  // --- Relationships ---
  doctor User @relation(fields: [doctorId], references: [id], onDelete: Cascade)
 
  // --- Constraints ---
  @@unique([doctorId, leaveDate])
  @@map("doctor_leaves")
}
 
// 6. AppSettings Table
// Stores global application settings for appointment scheduling.
model AppSettings {
  id                      String @id @default("global")
  slotsPerHour            Int    @default(2)
  startTime               String @default("09:00")
  endTime                 String @default("17:00")
  slotReservationDuration Int    @default(10) // in minutes
  @@map("app_settings")
}
 
// 7. WorkingDay Table
// Defines which days of the week are considered working days.
model WorkingDay {
  dayId        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dayOfWeek    Int   @unique  // Sunday=0, Monday=1, ...
  isWorkingDay Boolean @default(true)
  @@map("working_days")
}
 
// 8. Appointment Table
// Stores all details related to a booking.
model Appointment {
  appointmentId        String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId             String            @db.Uuid
  userId               String?           @db.Uuid
  guestIdentifier      String?
  patientType          PatientType
  patientRelation      String?
  patientName          String
  paymentMethod        String?
  paymentResult        Json?
  paidAt               DateTime?
  appointmentStartUTC  DateTime
  appointmentEndUTC    DateTime
  phoneNumber          String?
  reasonForVisit       String?           @db.Text
  additionalNotes      String?           @db.Text
  patientdateofbirth   DateTime?
  reservationExpiresAt DateTime?
  status               AppointmentStatus @default(PAYMENT_PENDING)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
 
  // --- Relationships ---
  doctor      User      @relation("DoctorAppointments", fields: [doctorId], references: [id])
  user     User?     @relation("UserAppointments", fields: [userId], references: [id])
  testimonial DoctorTestimonial?
  transactions Transaction[]
  @@map("appointments")
}
 
// 9. DoctorTestimonial Table
// Holds reviews and ratings submitted by patients.
model DoctorTestimonial {
  testimonialId String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointmentId String    @unique @db.Uuid
  doctorId      String    @db.Uuid
  patientId     String    @db.Uuid
  testimonialText String  @db.Text
  rating        Float?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
 
  // --- Relationships ---
  appointment Appointment @relation(fields: [appointmentId], references: [appointmentId], onDelete: Cascade)
  doctor      User        @relation("DoctorTestimonials", fields: [doctorId], references: [id])
  patient     User       @relation("PatientTestimonials", fields: [patientId], references: [id])
  @@map("doctor_testimonials")
}
 
// 10. Transaction Table
// Logs all financial transactions.
model Transaction {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointmentId        String            @db.Uuid
  doctorId             String            @db.Uuid
  paymentGateway       String //PAYPAL
  gatewayTransactionId String            @unique //PayPal - success : capture id , failure : order id
  amount               Float
  currency             String
  status               TransactionStatus
  transactionDate      DateTime          @default(now())
  notes                String? // store any error message on failure
  paymentDetails       Json? // raw gateway response
 
  // --- Relationships ---
  appointment Appointment @relation(fields: [appointmentId], references: [appointmentId],onDelete: Cascade)
  doctor      User        @relation(fields: [doctorId], references: [id])
  @@map("transactions")
}
 
// 11. BannerImage Table
// Manages banner images for the website/application.
model BannerImage { 
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  imageUrl  String
  fileKey   String   @unique
  order     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("banner_images")
}
 
// 12. Department Table
// Stores a list of medical departments or categories.
model Department {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @unique
  iconName  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("departments")
}
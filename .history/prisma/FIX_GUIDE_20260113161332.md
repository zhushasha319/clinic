# 数据库种子脚本 - 快速修复指南

## 问题修复

已修复 `BannerImage` 表的 `name` 字段缺少唯一约束的问题。

## 执行步骤

### 1. 重新生成 Prisma Client

```bash
npx prisma generate
```

### 2. 创建新的数据库迁移

如果数据库已存在，运行：

```bash
npx prisma migrate dev --name add_unique_banner_name
```

如果是全新数据库，运行：

```bash
npx prisma migrate dev --name init
```

### 3. 运行种子脚本

```bash
npx prisma db seed
```

## 如果遇到数据库已存在的错误

如果需要重置数据库（**警告：会删除所有数据**）：

```bash
npx prisma migrate reset
```

这会自动：

1. 删除数据库
2. 重新创建数据库
3. 应用所有迁移
4. 运行种子脚本

## 常见错误排查

### 错误：Unique constraint failed

**原因**：尝试插入重复数据

**解决**：

```bash
# 方案 1: 重置数据库
npx prisma migrate reset

# 方案 2: 手动删除冲突数据
npx prisma studio
# 在浏览器中打开，手动删除重复记录
```

### 错误：Cannot find module

**原因**：缺少依赖

**解决**：

```bash
npm install -D ts-node
npm install
```

### 错误：Database connection failed

**原因**：`.env` 文件配置错误

**解决**：
检查 `.env` 文件中的 `DATABASE_URL`：

```env
DATABASE_URL="postgresql://username:password@localhost:5432/clinic_db?schema=public"
```

## 验证种子数据

运行成功后，打开 Prisma Studio 验证：

```bash
npx prisma studio
```

应该看到：

- ✅ 1 条 App Settings 记录
- ✅ 7 条 Working Days 记录
- ✅ 6 条 Departments 记录
- ✅ 1 条 Banner Images 记录
- ✅ 7 条 Users 记录
